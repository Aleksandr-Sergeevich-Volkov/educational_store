{% extends "base.html" %}
{% load django_bootstrap5 %}
{% block title %}Доставка{% endblock %}
{% block content %}
            <!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" name="referrer" content="origin">
  <title>Пример работы виджета ПВЗ</title>
  <script src="https://cdn.jsdelivr.net/npm/@cdek-it/widget@3" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/@unocss/runtime" type="text/javascript"></script>
  <link href="https://cdn.jsdelivr.net/npm/@unocss/reset/tailwind.min.css" rel="stylesheet">
  <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', () => {
          window.widget = new window.CDEKWidget({
                                                    from: 'Химки',
                                                    root: 'cdek-map',
                                                    apiKey: '08505f2e-943d-4ed9-8195-1b5a2739c6a3',
                                                    canChoose: true,
                                                    servicePath: 'https://kompressionnye-chulki24.ru/service.php',
                                                    hideFilters: {
                                                        have_cashless: false,
                                                        have_cash: false,
                                                        is_dressing_room: false,
                                                        type: false,
                                                    },
                                                    hideDeliveryOptions: {
                                                        office: false,
                                                        door: true,
                                                    },
                                                    popup: true,
                                                    debug: true,
                                                    goods: [
                                                        {
                                                            width: 10,
                                                            height: 10,
                                                            length: 10,
                                                            weight: 10,
                                                        },
                                                    ],
                                                    defaultLocation: [37.4297, 55.897],
                                                    lang: 'rus',
                                                    currency: 'RUB',
                                                    tariffs: {
                                                        office: [233, 137, 139],
                                                        door: [234, 136, 138],
                                                    },
                                                    onReady() {
                                                        alert('Виджет загружен');
                                                    },
                                                    onCalculate() {
                                                        alert('Расчет стоимости доставки произведен');
                                                    },
                                                    onChoose(type, tariff, address) {
                                                        console.log('Выбран метод доставки', type, tariff, address);                                                        
                                                        if (type === 'door') {
                                                            alert(
                                                            'Выбрана доставка курьером по адресу\n' +
                                                            address.formatted +
                                                            '\n' +
                                                            'Цена ' + tariff.delivery_sum + '\n' +
                                                            'Срок ' + tariff.period_max + ' дн.',                                                            
                                                            );
                                                        document.getElementById('sum').value = tariff.delivery_sum;
                                                        document.getElementById('address_pvz').value = address.name;} 
                                                            
                                                        else {
                                                            alert(
                                                            'Выбран пункт выдачи заказа ' + address.name + '\n' +
                                                            'Цена ' + tariff.delivery_sum + '\n' +
                                                            'Срок ' + tariff.period_max + ' дн.',
                                                            );
                                                            document.getElementById('sum').value = tariff.delivery_sum;
                                                            document.getElementById('address_pvz').value = address.name;
                                                            }
                                                    },
                                                });
      });
  </script>
</head>
<body class="ml-2">
  <p class="m-2">Выводим сообщение, что выбран пункт самовывоза</p>
  <button onclick="window.widget.open()" class="p-1 my-2 border-stone-500 border-2 rounded-md">Показать ПВЗ</button>
</body>
</html>
    <form action="" method="get" class="order-form">
    {{ form.as_table }}
        <p><input type="submit" class="btn btn-primary" value="Подтвердить заказ"></p>
        {% csrf_token %}
    </form>
{% endblock %}