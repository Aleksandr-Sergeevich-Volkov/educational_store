{% extends "base.html" %}
{% load django_bootstrap5 %}
{% block title %}–î–æ—Å—Ç–∞–≤–∫–∞ –°–î–≠–ö{% endblock %}
{% block content %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" name="referrer" content="origin">
  <title>–í—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏ –°–î–≠–ö</title>
  <script src="https://cdn.jsdelivr.net/npm/@cdek-it/widget@3" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/@unocss/runtime" type="text/javascript"></script>
  <link href="https://cdn.jsdelivr.net/npm/@unocss/reset/tailwind.min.css" rel="stylesheet">
  <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', () => {
          window.widget = new window.CDEKWidget({
              from: '–•–∏–º–∫–∏',
              root: 'cdek-map',
              apiKey: '08505f2e-943d-4ed9-8195-1b5a2739c6a3',
              canChoose: true,
              servicePath: 'https://kompressionnye-chulki24.ru/service.php',
              hideFilters: {
                  have_cashless: false,
                  have_cash: false,
                  is_dressing_room: false,
                  type: false,
              },
              hideDeliveryOptions: {
                  office: false,
                  door: true,
              },
              popup: true,
              debug: true,
              goods: [
                  {
                      width: 10,
                      height: 10,
                      length: 10,
                      weight: 10,
                  },
              ],
              defaultLocation: [37.4297, 55.897],
              lang: 'rus',
              currency: 'RUB',
              tariffs: {
                  office: [234, 136],
                  door: [234, 136, 138],
              },
              onReady() {
                  console.log('–í–∏–¥–∂–µ—Ç –°–î–≠–ö –∑–∞–≥—Ä—É–∂–µ–Ω');
              },
              onCalculate() {
                  console.log('–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω');
              },
              onChoose(type, tariff, address) {
                  console.log('–í—ã–±—Ä–∞–Ω –º–µ—Ç–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏', type, tariff, address);                                                        
                  if (type === 'door') {
                      alert(
                      '–í—ã–±—Ä–∞–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –∫—É—Ä—å–µ—Ä–æ–º –ø–æ –∞–¥—Ä–µ—Å—É\n' +
                      address.formatted +
                      '\n' +
                      '–¶–µ–Ω–∞ ' + tariff.delivery_sum + '\n' +
                      '–°—Ä–æ–∫ ' + tariff.period_max + ' –¥–Ω.',                                                            
                      );
                  document.getElementById('id_sum').value = tariff.delivery_sum;
                  document.getElementById('id_address_pvz').value = address.name;} 
                      
                  else {
                      alert(
                      '–í—ã–±—Ä–∞–Ω –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –∑–∞–∫–∞–∑–∞ ' + address.name + '\n' +
                      '–¶–µ–Ω–∞ ' + tariff.delivery_sum + '\n' +
                      '–°—Ä–æ–∫ ' + tariff.period_max + ' –¥–Ω.',
                      );
                      document.getElementById('id_sum').value = tariff.delivery_sum;
                      document.getElementById('id_address_pvz').value = address.name;
                  }
                  
                  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –≤—ã–±–æ—Ä–∞
                  document.getElementById('selection-status').innerHTML = 
                      '<div class="alert alert-success mt-2">‚úÖ –í—ã–±—Ä–∞–Ω –ø—É–Ω–∫—Ç: ' + address.name + '</div>';
              },
          });
      });
  </script>
</head>
<body>
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –≤–∏–¥–∂–µ—Ç–æ–º -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="card-title mb-0">üó∫Ô∏è –í—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏ –°–î–≠–ö</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-3">
                        <strong>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É —Å –ø—É–Ω–∫—Ç–∞–º–∏ –≤—ã–¥–∞—á–∏ –°–î–≠–ö
                    </div>
                    
                    <button onclick="window.widget.open()" class="btn btn-warning btn-lg w-100 py-3 mb-3">
                        üìç –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É –ü–í–ó –°–î–≠–ö
                    </button>
                    
                    <div id="selection-status"></div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å —Ñ–æ—Ä–º–æ–π -->
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h4 class="card-title mb-0">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞</h4>
                </div>
                <div class="card-body">
                    <form action="" method="get" class="order-form">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-12">
                                {% bootstrap_form form %}
                            </div>
                        </div>
                        
                        <div class="alert alert-warning mt-3">
                            <strong>üí° –í–∞–∂–Ω–æ:</strong> –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø—É–Ω–∫—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—Å—è –≤ —Ñ–æ—Ä–º–µ –≤—ã—à–µ
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg py-3">
                                ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border: none;
    border-radius: 12px;
}

.card-header {
    border-radius: 12px 12px 0 0 !important;
    font-weight: 600;
}

.btn {
    border-radius: 8px;
    font-weight: 500;
}

.alert {
    border-radius: 8px;
    border: none;
}

.form-control, .form-select {
    border-radius: 6px;
    padding: 0.75rem 1rem;
}

.form-label {
    font-weight: 500;
    margin-bottom: 0.5rem;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    .container-fluid {
        padding: 1rem;
    }
    
    .btn-lg {
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
    }
}
</style>
</body>
</html>
{% endblock %}