{% extends "base.html" %}
{% load static %}
{% load django_bootstrap5 %}

<head>
    <title>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–∞ –∫–æ–º–ø—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–≥–æ —Ç—Ä–∏–∫–æ—Ç–∞–∂–∞</title>
</head>

{% block content %}
<div class="mb-3">
    <h2 class="card-header font-family:sans-serif">–ú–∞–≥–∞–∑–∏–Ω kompressionnye-chulki24.ru</h2>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ -->
<div class="btn-group d-grid gap-2 d-md-flex justify-content-md-end mb-4 flex-column flex-md-row">
    <a href="catalog/" class="btn btn-primary mb-2 mb-md-0">–ö–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤</a>
    <a href="search/" class="btn btn-primary">–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤</a>
    <a href="size_finder/" class="btn btn-primary">–ü–æ–¥–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞</a>              
</div>    
<div class="row mb-4">
    <div class="col-12 col-md-4 text-center text-md-start">
        <img src="{% static 'logo.jpeg' %}" 
             alt="–õ–æ–≥–æ—Ç–∏–ø –º–∞–≥–∞–∑–∏–Ω–∞" 
             class="mb-3 img-fluid"
             style="max-width: 100%; height: auto;">
        <div class="mt-2">
            <b><i>–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –Ω–∞—à–µ–º –º–∞–≥–∞–∑–∏–Ω–µ: {{prod_count.id__count}}</b></i>
        </div>
    </div>
    <div class="col-12 col-md-4 mt-3 mt-md-0">
        <b><i>–°–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ:</b></i>
        {% for prod in product %} 
        <p class="mb-2">
            <a href="{% url 'catalog:detail' prod.slug %}" class="card-link">{{prod.name}}</a>
        </p>
        {% endfor %} 
    </div>
    <div class="col-12 col-md-4 mt-3 mt-md-0">
        {% for post in text %} 
   <div class="mb-3">
    <p class="h5 mb-2">{{ post.title }}</p>          
    
    <div class="post-content">
        <p class="card-text mb-2" id="text-{{ post.id }}">
            {{ post.text|truncatewords:25 }}
        </p>
    </div>
    
    <div class="d-flex gap-2 flex-wrap">
        <button class="btn btn-outline-primary btn-sm" 
                onclick="toggleFullText({{ post.id }}, '{{ post.text|escapejs }}')">
            üìñ –ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
        </button>
        
        <button class="btn btn-outline-secondary btn-sm comments-btn" 
                data-post-id="{{ post.id }}"
                data-comment-count="{{ post.comment_count }}"
                onclick="toggleComments({{ post.id }})">
            üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comment_count }})
        </button>
    </div>
    
    <!-- –ë–ª–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
    <div id="comments-{{ post.id }}" class="comments-section mt-3" style="display: none;">
        <div class="card">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comment_count }})</h6>
                <button class="btn btn-close btn-sm" onclick="toggleComments({{ post.id }})"></button>
            </div>
            <div class="card-body">
                {% if post.comments.all %}
                    {% for comment in post.comments.all %}
                    <div class="comment mb-3 pb-3 border-bottom">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <strong class="text-primary">{{ comment.author.username }}</strong>
                                <small class="text-muted ms-2">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                                {% if comment.updated_at != comment.created_at %}
                                <small class="text-muted ms-2">(–∏–∑–º–µ–Ω–µ–Ω–æ)</small>
                                {% endif %}
                            </div>
                            
                            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                            {% if user == comment.author %}
                            <div class="btn-group btn-group-sm">
                                <a href="{% url 'homepage:edit_comment' post.id comment.id %}" 
                                   class="btn btn-outline-warning btn-sm"
                                   title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
                                    ‚úèÔ∏è
                                </a>
                                <a href="{% url 'homepage:delete_comment' post.id comment.id %}" 
                                   class="btn btn-outline-danger btn-sm"
                                   title="–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
                                   onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?');">
                                    üóëÔ∏è
                                </a>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- –¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                        <p class="mb-0 comment-text">
                            {{ comment.text }}
                        </p>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted mb-0">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                {% endif %}
                
                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                {% if user.is_authenticated %}
                <div class="add-comment mt-3 pt-3 border-top">
                    <form method="post" action="{% url 'homepage:add_comment' post.id %}" class="comment-form">
                        {% csrf_token %}
                        <div class="mb-2">
                            <textarea name="text" class="form-control form-control-sm" 
                                      rows="2" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">üí¨ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
                    </form>
                </div>
                {% else %}
                <div class="mt-3 pt-3 border-top">
                    <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-outline-primary btn-sm">
                        üîë –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å—Ç–∞
function toggleFullText(postId, fullText) {
    const textElement = document.getElementById(`text-${postId}`);
    const button = event.target;
    
    if (button.textContent.includes('–ß–∏—Ç–∞—Ç—å')) {
        textElement.textContent = fullText;
        button.textContent = 'üìñ –°–≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—Å—Ç';
        button.classList.add('active');
    } else {
        const words = fullText.split(' ');
        const shortText = words.length > 25 ? words.slice(0, 25).join(' ') + '...' : fullText;
        textElement.textContent = shortText;
        button.textContent = 'üìñ –ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç';
        button.classList.remove('active');
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
function toggleComments(postId) {
    const commentsSection = document.getElementById(`comments-${postId}`);
    const button = document.querySelector(`[data-post-id="${postId}"]`);
    const commentCount = button.getAttribute('data-comment-count');
    
    if (commentsSection.style.display === 'none') {
        commentsSection.style.display = 'block';
        button.textContent = 'üí¨ –°–∫—Ä—ã—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏';
        button.classList.add('active');
        
        commentsSection.style.opacity = '0';
        commentsSection.style.transition = 'opacity 0.3s ease';
        setTimeout(() => {
            commentsSection.style.opacity = '1';
        }, 10);
    } else {
        commentsSection.style.opacity = '0';
        setTimeout(() => {
            commentsSection.style.display = 'none';
            button.textContent = `üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (${commentCount})`;
            button.classList.remove('active');
        }, 300);
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–ø—Ä–æ—Å—Ç–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞)
document.addEventListener('DOMContentLoaded', function() {
    const commentForms = document.querySelectorAll('.comment-form');
    commentForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            // –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –æ–±—ã—á–Ω—ã–º way, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
            // –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–∫ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–±–æ–ª—å—à—É—é –∞–Ω–∏–º–∞—Ü–∏—é
            const button = this.querySelector('button[type="submit"]');
            button.innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            button.disabled = true;
        });
    });
});
</script>

<style>
.comments-section {
    transition: all 0.3s ease;
}

.btn.active {
    background-color: #0d6efd;
    color: white;
    border-color: #0d6efd;
}

.comment:last-child {
    border-bottom: none !important;
    margin-bottom: 0 !important;
    padding-bottom: 0 !important;
}

.add-comment {
    background-color: #f8f9fa;
    border-radius: 0.375rem;
    padding: 1rem;
}

.comment-form textarea {
    resize: vertical;
    min-height: 80px;
}

.d-flex.gap-2 {
    gap: 0.5rem;
}

.card {
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
}

.btn-group-sm .btn {
    padding: 0.125rem 0.25rem;
    font-size: 0.75rem;
    text-decoration: none;
}
</style>
        {% endfor %}        
    </div>
</div>

<div class="btn-group mt-3 mb-4">
    <a href="{% static 'oferta.pdf' %}" class="btn btn-primary">–û—Ñ–µ—Ä—Ç–∞</a> 
</div>

<div class="row mt-4">
    <div class="col-12 col-md-8 mb-3 mb-md-0">     
        <div class="text-center text-md-start" style="font-size: 12px; font-family:sans-serif;">
            <strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong><br>
            –û–û–û "–ö–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥–æ–≤—ã–π –¶–µ–Ω—Ç—Ä "–ê–ª–≥–æ—Ä–∏—Ç–º"<br>
            –†–µ–∫–≤–∏–∑–∏—Ç—ã: —Ä/—Å 40702810200010000418 –≤ –ê–ö–ë "–ê–ë–°–û–õ–Æ–¢ –ë–ê–ù–ö" (–ü–ê–û) –∫/—Å 30101810500000000976 –±–∏–∫ 044525976<br>
            –ê–¥—Ä–µ—Å: 141402, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –≥–æ—Ä–æ–¥ –•–∏–º–∫–∏, –°–æ—é–∑–Ω–∞—è —É–ª., –¥. 3, –æ—Ñ–∏—Å 15<br>
            –¢–µ–ª–µ—Ñ–æ–Ω/Telegram/WhatsApp: 8-906-717-48-77<br>
            e-mail: volkov_aleksandr_sergeevich@mail.ru
        </div>
    </div>
    <div class="col-12 col-md-3 text-center"> 
        <a title="Telegram" href="https://telegram.me/volkovaleksandrsergeevich" target="_blank">
            <img src="{% static 'telegram_icon.jpg' %}" class="img-fluid" style="max-width: 75px;" alt='–ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram'>
        </a>
    </div>
</div>
{% endblock %}