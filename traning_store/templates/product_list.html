{% extends "base.html" %}
{% load catalog_tags %}
{% load django_bootstrap5 %}
{% load static %}

<head>
    <title>Список компрессионного трикотажа</title>
</head>

{% block content %}
<div class="container-fluid">
    <!-- Заголовок и счетчик -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="mb-3">Всего товаров отобрано: {{prod_count.id__count}}</h4>
        </div>
    </div>

    <!-- Форма фильтрации - показываем ВСЕ поля -->
    <div class="row mb-4">
        <div class="col-12">
            <form method="get" class="filter-form">
                <div class="row g-3 align-items-end">
                    <!-- Все поля фильтра -->
                    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                        <label for="{{ filter.form.Appointment.id_for_label }}" class="form-label">Назначение</label>
                        {{ filter.form.Appointment }}
                    </div>
                    
                    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                        <label for="{{ filter.form.Sock.id_for_label }}" class="form-label">Тип носка</label>
                        {{ filter.form.Sock }}
                    </div>
                    
                    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                        <label for="{{ filter.form.brand.id_for_label }}" class="form-label">Производитель</label>
                        {{ filter.form.brand }}
                    </div>
                    
                    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                        <label for="{{ filter.form.Class_compress.id_for_label }}" class="form-label">Класс компрессии</label>
                        {{ filter.form.Class_compress }}
                    </div>
                    
                    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                        <label for="{{ filter.form.Type_product.id_for_label }}" class="form-label">Вид изделия</label>
                        {{ filter.form.Type_product }}
                    </div>
                    
                    <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                        <label for="{{ filter.form.Male.id_for_label }}" class="form-label">Пол</label>
                        {{ filter.form.Male }}
                    </div>
                    
                    <!-- Кнопки фильтра -->
                    <div class="col-12 mt-2">
                        <button type="submit" class="btn btn-primary">Применить фильтр</button>
                        <a href="?" class="btn btn-outline-secondary ms-2">Сбросить</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Список товаров -->
    <div class="row">
        {% for product in page_obj.object_list %}
        <div class="col-12 col-sm-6 col-lg-4 col-xl-3 mb-4">
            <div class="card h-100" itemscope itemtype="https://schema.org/Product">
                <!-- Изображение товара -->
                <div class="text-center p-3">
                    {% for image in product.main_images %}
                    <a href="{% url 'catalog:detail' product.slug %}">
                        <img src="{{ image.image.url }}" 
                             alt="{{ product.name }}" 
                             class="card-img-top img-fluid" 
                             style="max-height: 200px; width: auto; object-fit: contain;"
                             itemprop="image">
                    </a>
                    {% empty %}
                    <div class="bg-light d-flex align-items-center justify-content-center" 
                         style="height: 200px;">
                        <span class="text-muted">Нет изображения</span>
                    </div>
                    {% endfor %}
                </div>

                <!-- Информация о товаре -->
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">
                        <a href="{% url 'catalog:detail' product.slug %}" class="text-decoration-none" itemprop="name">
                            {{ product.name }}
                        </a>
                    </h5>
                    
                    <div class="mb-2">
                        <small class="text-muted">Производитель:</small>
                        <span class="fw-bold" itemprop="brand">{{ product.brand }}</span>
                    </div>
                    
                    <div class="mb-2">
                        <small class="text-muted">Категория:</small>
                        <span itemprop="description">компрессионный трикотаж</span>
                    </div>

                    <!-- Цена -->
                    <div class="mt-auto" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="h5 text-primary mb-0">
                                {{ product.price }} ₽
                                <meta itemprop="price" content="{{ product.price }}">
                                <meta itemprop="priceCurrency" content="RUB">
                            </span>
                            <meta itemprop="availability" href="http://schema.org/InStock">
                        </div>
                    </div>

                    <!-- Кнопка подробнее -->
                    <a href="{% url 'catalog:detail' product.slug %}" 
                       class="btn btn-outline-primary mt-2 w-100">
                        Подробнее
                    </a>
                </div>
            </div>
        </div>
        
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info text-center">
                <h5>Товары не найдены</h5>
                <p class="mb-0">Попробуйте изменить параметры фильтрации</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Пагинация -->
    <div class="row mt-4">
        <div class="col-12">
            {% include "includes/paginator.html" %}
        </div>
    </div>
</div>

<style>
.filter-form .form-label {
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.filter-form select {
    font-size: 0.875rem;
    width: 100%;
    padding: 0.375rem 0.75rem;
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    background-color: white;
}

.filter-form select:focus {
    border-color: #86b7fe;
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

/* На мобильных - больше отступов между полями */
@media (max-width: 768px) {
    .filter-form .col-12 {
        margin-bottom: 0.5rem;
    }
}
</style>
{% endblock %}